import pymorphy3

morph = pymorphy3.MorphAnalyzer()

VERBS_PAST = {
    'готовить': {'masc': 'готовил', 'femn': 'готовила', 'neut': 'готовило'},
    'кататься': {'masc': 'катался', 'femn': 'каталась', 'neut': 'каталось'},
    'танцевать': {'masc': 'танцевал', 'femn': 'танцевала', 'neut': 'танцевало'},
    'смотреть': {'masc': 'смотрел', 'femn': 'смотрела', 'neut': 'смотрело'},
    'бегать': {'masc': 'бегал', 'femn': 'бегала', 'neut': 'бегало'},
    'прыгать': {'masc': 'прыгал', 'femn': 'прыгала', 'neut': 'прыгало'},
    'плавать': {'masc': 'плавал', 'femn': 'плавала', 'neut': 'плавало'},
    'читать': {'masc': 'читал', 'femn': 'читала', 'neut': 'читало'},
    'писать': {'masc': 'писал', 'femn': 'писала', 'neut': 'писало'},
    'рисовать': {'masc': 'рисовал', 'femn': 'рисовала', 'neut': 'рисовало'},
    'спать': {'masc': 'спал', 'femn': 'спала', 'neut': 'спало'},
    'петь': {'masc': 'пел', 'femn': 'пела', 'neut': 'пело'},
    'играть': {'masc': 'играл', 'femn': 'играла', 'neut': 'играло'},
    'варить': {'masc': 'варил', 'femn': 'варила', 'neut': 'варило'},
    'шутить': {'masc': 'шутил', 'femn': 'шутила', 'neut': 'шутило'},
    'летать': {'masc': 'летал', 'femn': 'летала', 'neut': 'летало'},
    'программировать': {'masc': 'программировал', 'femn': 'программировала', 'neut': 'программировало'},
    'размышлять': {'masc': 'размышлял', 'femn': 'размышляла', 'neut': 'размышляло'},
    'путешествовать': {'masc': 'путешествовал', 'femn': 'путешествовала', 'neut': 'путешествовало'},
    'флиртовать': {'masc': 'флиртовал', 'femn': 'флиртовала', 'neut': 'флиртовало'},
    'загорать': {'masc': 'загорал', 'femn': 'загорала', 'neut': 'загорало'},
    'медитировать': {'masc': 'медитировал', 'femn': 'медитировала', 'neut': 'медитировало'},
    'парковать': {'masc': 'парковал', 'femn': 'парковала', 'neut': 'парковало'},
    'исследовать': {'masc': 'исследовал', 'femn': 'исследовала', 'neut': 'исследовало'},
    'строить': {'masc': 'строил', 'femn': 'строила', 'neut': 'строило'},
    'разрушать': {'masc': 'разрушал', 'femn': 'разрушала', 'neut': 'разрушало'},
    'создавать': {'masc': 'создавал', 'femn': 'создавала', 'neut': 'создавало'},
    'изучать': {'masc': 'изучал', 'femn': 'изучала', 'neut': 'изучало'},
    'обучать': {'masc': 'обучал', 'femn': 'обучала', 'neut': 'обучало'},
    'кодировать': {'masc': 'кодировал', 'femn': 'кодировала', 'neut': 'кодировало'},
    
    # ВОТ ИСПРАВЛЕНИЯ:
    'смеяться': {'masc': 'смеялся', 'femn': 'смеялась', 'neut': 'смеялось'},
    'плакать': {'masc': 'плакал', 'femn': 'плакала', 'neut': 'плакало'},
    'мечтать': {'masc': 'мечтал', 'femn': 'мечтала', 'neut': 'мечтало'},
}

# Автоматическая функция для глаголов, которых нет в словаре
def get_verb_in_past(verb, gender):
    """Возвращает глагол в прошедшем времени"""
    verb_lower = verb.lower()
    
    # 1. Проверяем словарь
    if verb_lower in VERBS_PAST:
        return VERBS_PAST[verb_lower][gender]
    
    # 2. Для возвратных глаголов на -ться
    if verb_lower.endswith('ться'):
        stem = verb_lower[:-4]
        if gender == 'masc':
            return stem + 'лся'
        elif gender == 'femn':
            return stem + 'лась'
        else:
            return stem + 'лось'
    
    # 3. Для обычных глаголов на -ть
    elif verb_lower.endswith('ть'):
        stem = verb_lower[:-2]
        if gender == 'masc':
            return stem + 'л'
        elif gender == 'femn':
            return stem + 'ла'
        else:
            return stem + 'ло'
    
    # 4. Запасной вариант
    return verb

# Специальные формы для мест с правильными предлогами
SPECIAL_PLACES = {
    # Места с предлогом "В"
    'холодильник': ('в', 'холодильнике'),
    'университет': ('в', 'университете'),
    'космос': ('в', 'космосе'),
    'шкаф': ('в', 'шкафу'),
    'кофейня': ('в', 'кофейне'),
    'библиотека': ('в', 'библиотеке'),
    'ванна': ('в', 'ванне'),
    'интернет': ('в', 'интернете'),
    'лифт': ('в', 'лифте'),
    'кинотеатр': ('в', 'кинотеатре'),
    'супермаркет': ('в', 'супермаркете'),
    'стадион': ('на', 'стадионе'),
    'музей': ('в', 'музее'),
    'самолёт': ('в', 'самолёте'),
    'поезд': ('в', 'поезде'),
    'метро': ('в', 'метро'),
    'автобус': ('в', 'автобусе'),
    'такси': ('в', 'такси'),
    'пещера': ('в', 'пещере'),
    'замок': ('в', 'замке'),
    'небоскрёб': ('в', 'небоскрёбе'),
    'подвал': ('в', 'подвале'),
    'чердак': ('на', 'чердаке'),
    'сарай': ('в', 'сарае'),
    'гараж': ('в', 'гараже'),
    'аквапарк': ('в', 'аквапарке'),
    'зоопарк': ('в', 'зоопарке'),
    'планетарий': ('в', 'планетарии'),
    
    # Места с предлогом "НА"
    'парк': ('в', 'парке'),
    'пляж': ('на', 'пляже'),
    'горка': ('на', 'горке'),
    'карусель': ('на', 'карусели'),
    'эскалатор': ('на', 'эскалаторе'),
    'площадь': ('на', 'площади'),
    'улица': ('на', 'улице'),
    'остров': ('на', 'острове'),
    'гора': ('на', 'горе'),
    
    # Особые случаи
    'лес': ('в', 'лесу'),
    'сад': ('в', 'саду'),
    'берег': ('на', 'берегу'),
    'река': ('на', 'реке'),
    'озеро': ('на', 'озере'),
    'поле': ('на', 'поле'),
    'пустыня': ('в', 'пустыне'),
}

def get_place_with_preposition(place):
    """Возвращает правильный предлог и место в нужном падеже"""
    place_lower = place.lower()
    
    # Если место есть в специальном словаре
    if place_lower in SPECIAL_PLACES:
        preposition, place_form = SPECIAL_PLACES[place_lower]
        return preposition, place_form
    
    # Для остальных мест используем "в" + предложный падеж
    try:
        place_parsed = morph.parse(place)[0]
        place_form = place_parsed.inflect({'loct'}).word
        return 'в', place_form
    except:
        return 'в', place

def make_sentence(noun, verb, adjective, place):
    """Собираем грамматически правильное предложение"""
    
    # 1. Существительное
    noun_parsed = morph.parse(noun)[0]
    gender = noun_parsed.tag.gender
    noun_word = noun_parsed.inflect({'nomn'}).word
    
    # 2. Прилагательное
    adj_parsed = morph.parse(adjective)[0]
    adj_word = adj_parsed.inflect({gender, 'nomn'}).word
    
    # 3. Глагол (используем новую функцию)
    verb_word = get_verb_in_past(verb, gender)
    
    # 4. Место с правильным предлогом
    preposition, place_word = get_place_with_preposition(place)
    
    # 5. Собираем предложение
    return f"{adj_word.capitalize()} {noun_word} {verb_word} {preposition} {place_word}."