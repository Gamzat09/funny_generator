<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–º–µ—à–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π</title>
    
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <meta name="description" content="–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Å–º–µ—à–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π">
    <meta name="keywords" content="–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä, —Å–º–µ—à–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫, –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
</head>
<body>
    <div id="cosmos-starfield"></div>
    <div class="container">
        <button id="theme-toggle" class="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
            <span class="theme-icon active" id="sun-icon">‚òÄÔ∏è</span>
            <span class="theme-icon" id="moon-icon">üåô</span>
        </button>
        
        <h1><span class="emoji-mask">üé≠</span> –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–º–µ—à–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π</h1>
        <p class="subtitle">–ö–∞–∂–¥–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ—Ä–Ω–æ!</p>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button id="tab-generate" class="tab-btn active">
                <i class="fas fa-dice"></i> –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä
            </button>
            <button id="tab-history" class="tab-btn">
                <i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è
            </button>
            <button id="tab-favorites" class="tab-btn">
                <i class="fas fa-heart"></i> –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
            </button>
            <button id="tab-themes" class="tab-btn">
                <i class="fas fa-palette"></i> –¢–µ–º—ã
            </button>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ -->
        <div id="tab-content-generate" class="tab-content active">
            <div class="card">
                <div style="display: flex; align-items: center; justify-content: center;">
                    <div id="sentence" class="sentence" style="cursor: pointer; flex-grow: 1;">
                        –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏...
                    </div>
                    <button id="favorite-btn" class="favorite-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">
                        <i class="far fa-heart"></i>
                    </button>
                </div>
                <div id="words" class="words" style="display: none;">
                    <strong>–ò—Å—Ö–æ–¥–Ω—ã–µ —Å–ª–æ–≤–∞:</strong>
                    <div id="word-list"></div>
                </div>
            </div>
            
            <div class="buttons">
                <button id="generate-btn" class="btn">
                    <span class="emoji">üé≤</span> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å!
                </button>
                <button id="auto-btn" class="btn">
                    <span class="emoji">‚ñ∂Ô∏è</span> –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è
                </button>
                <button id="copy-btn" class="btn">
                    <span class="emoji">üìã</span> –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button id="show-words-btn" class="btn">
                    <span class="emoji">üîç</span> –ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≤–∞
                </button>
            </div>
            
            <div id="progress-container" class="progress-container">
                <div class="progress-header">
                    <small>–°–ª–µ–¥—É—é—â–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑:</small>
                    <small id="countdown">8 —Å–µ–∫</small>
                </div>
                <div class="progress-track">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
            </div>
            
            <div class="stats">
                –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: <span id="counter">0</span> –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π | 
                –í—Å–µ–≥–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π: <span id="total-combinations">–∑–∞–≥—Ä—É–∑–∫–∞...</span>
                <br>
                <span id="auto-status" style="font-size: 0.9em; opacity: 0.8;">–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—ã–∫–ª—é—á–µ–Ω–∞</span>
            </div>
            
            <div class="hotkeys-info">
                <h3><span class="emoji">‚å®Ô∏è</span> –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏:</h3>
                <div class="hotkeys-grid">
                    <div class="hotkey-item">
                        <kbd>Space</kbd> –∏–ª–∏ <kbd>Enter</kbd>
                        <span>–ù–æ–≤–∞—è —Ñ—Ä–∞–∑–∞</span>
                    </div>
                    <div class="hotkey-item">
                        <kbd>Alt</kbd> + <kbd>T</kbd>
                        <span>–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</span>
                    </div>
                    <div class="hotkey-item">
                        <kbd>Alt</kbd> + <kbd>A</kbd>
                        <span>–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è</span>
                    </div>
                    <div class="hotkey-item">
                        <kbd>Alt</kbd> + <kbd>C</kbd>
                        <span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ—Ä–∞–∑—É</span>
                    </div>
                    <div class="hotkey-item">
                        <kbd>Alt</kbd> + <kbd>W</kbd>
                        <span>–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Å–ª–æ–≤–∞</span>
                    </div>
                    <div class="hotkey-item">
                        <kbd>Alt</kbd> + <kbd>F</kbd>
                        <span>–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
                    </div>
                    <div class="hotkey-item">
                        <kbd>Alt</kbd> + <kbd>4</kbd>
                        <span>–í–∫–ª–∞–¥–∫–∞ –¢–µ–º—ã</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="mouse-hint">üëÜ –ö–ª–∏–∫ –Ω–∞ —Ñ—Ä–∞–∑—É</span>
                        <span>–ù–æ–≤–∞—è —Ñ—Ä–∞–∑–∞</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –ò—Å—Ç–æ—Ä–∏–∏ -->
        <div id="tab-content-history" class="tab-content">
            <div class="section-card">
                <h3><i class="fas fa-history"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ñ—Ä–∞–∑</h3>
                <div id="history-list">
                    <div class="empty-message">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –ø–µ—Ä–≤—É—é —Ñ—Ä–∞–∑—É!</div>
                </div>
            </div>
            <div class="info">
                <p>üìù –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±—É—é —Ñ—Ä–∞–∑—É –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –µ—ë —Å–Ω–æ–≤–∞ –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ</p>
                <p>‚è∞ –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –±—Ä–∞—É–∑–µ—Ä–∞</p>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ -->
        <div id="tab-content-favorites" class="tab-content">
            <div class="section-card">
                <h3><i class="fas fa-heart"></i> –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã</h3>
                <div id="favorites-list">
                    <div class="empty-message">–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º –ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Ñ—Ä–∞–∑—É!</div>
                </div>
            </div>
            <div class="info">
                <p>üíñ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ</p>
                <p>üóëÔ∏è –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ—Ä–∑–∏–Ω—É, —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å —Ñ—Ä–∞–∑—É –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</p>
                <p>üìã –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Ñ—Ä–∞–∑—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –µ—ë –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ</p>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –¢–µ–º -->
        <div id="tab-content-themes" class="tab-content">
            <div class="themes-header">
                <p class="themes-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</p>
                <p class="themes-current">–¢–µ–∫—É—â–∞—è —Ç–µ–º–∞: <strong id="current-theme-name">–°–≤–µ—Ç–ª–∞—è</strong></p>
            </div>
            <div class="themes-grid" id="themes-grid"></div>
            <div class="info">
                <p>üé® –¢–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ</p>
                <p>‚å®Ô∏è <kbd>Alt</kbd> + <kbd>T</kbd> ‚Äî –±—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–≤–µ—Ç–ª–æ–π –∏ —Ç—ë–º–Ω–æ–π</p>
            </div>
        </div>
        
        <div class="info">
            <p>‚ú® –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç pymorphy3 –¥–ª—è –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–∫–ª–æ–Ω–µ–Ω–∏—è —Å–ª–æ–≤</p>
            <p>üåô –ù–∞–∂–º–∏ –Ω–∞ —Å–æ–ª–Ω—ã—à–∫–æ/–ª—É–Ω—É –¥–ª—è —Å–º–µ–Ω—ã —Ç–µ–º—ã</p>
            <p>‚ö° –ù–∞–∂–º–∏ "–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è" –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–º–µ–Ω—ã —Ñ—Ä–∞–∑ –∫–∞–∂–¥—ã–µ <strong>8 —Å–µ–∫—É–Ω–¥</strong></p>
            <p>üñ±Ô∏è –ö–ª–∏–∫–Ω–∏ –Ω–∞ —Ñ—Ä–∞–∑—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏</p>
            <p id="install-prompt" style="display: none;">
                üì± <a href="#" id="install-btn" style="color: var(--primary); font-weight: bold;">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</a> –¥–ª—è —Ä–∞–±–æ—Ç—ã –æ—Ñ—Ñ–ª–∞–π–Ω
            </p>
        </div>
    </div>

    <script>
        // === –ó–í–Å–ó–î–ù–´–ô –§–û–ù ===
        function createStarfield() {
            const starfield = document.getElementById('cosmos-starfield');
            starfield.innerHTML = '';
            const count = 180;
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 2.5 + 0.5;
                const opacity = Math.random() * 0.7 + 0.15;
                const duration = (Math.random() * 3 + 1.5).toFixed(1) + 's';
                star.style.cssText = `
                    width: ${size}px; height: ${size}px;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    --opacity: ${opacity};
                    --duration: ${duration};
                    animation-delay: ${(Math.random() * 3).toFixed(1)}s;
                `;
                starfield.appendChild(star);
            }
            // –ü–∞–¥–∞—é—â–∏–µ –∑–≤—ë–∑–¥—ã
            for (let i = 0; i < 4; i++) {
                const shooting = document.createElement('div');
                shooting.className = 'star shooting';
                const shootDuration = (Math.random() * 4 + 3).toFixed(1) + 's';
                shooting.style.cssText = `
                    left: ${Math.random() * 60}%;
                    top: ${Math.random() * 40}%;
                    --shoot-duration: ${shootDuration};
                    animation-delay: ${(Math.random() * 6).toFixed(1)}s;
                `;
                starfield.appendChild(shooting);
            }
        }

        createStarfield();

        // === –¢–ï–ú–´ ===
        const THEMES = [
            {
                id: 'light',
                name: '–°–≤–µ—Ç–ª–∞—è',
                emoji: '‚òÄÔ∏è',
                description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞',
                preview: ['#667eea', '#764ba2', '#ffffff', '#f8f9fa']
            },
            {
                id: 'dark',
                name: '–¢—ë–º–Ω–∞—è',
                emoji: 'üåô',
                description: '–¢—ë–º–Ω–∞—è –¥–ª—è –≥–ª–∞–∑',
                preview: ['#8a63d2', '#c471ed', '#1a1a2e', '#2d2d44']
            },
            {
                id: 'sunset',
                name: '–ó–∞–∫–∞—Ç',
                emoji: 'üåÖ',
                description: '–¢—ë–ø–ª—ã–µ –æ—Ä–∞–Ω–∂–µ–≤—ã–µ —Ç–æ–Ω–∞',
                preview: ['#ff7e5f', '#feb47b', '#fff5f0', '#ffe3d8']
            },
            {
                id: 'ocean',
                name: '–û–∫–µ–∞–Ω',
                emoji: 'üåä',
                description: '–ü—Ä–æ—Ö–ª–∞–¥–Ω—ã–µ –º–æ—Ä—Å–∫–∏–µ —Ü–≤–µ—Ç–∞',
                preview: ['#0077b6', '#00b4d8', '#f0fbff', '#e0f7ff']
            },
            {
                id: 'forest',
                name: '–õ–µ—Å',
                emoji: 'üå≤',
                description: '–°–≤–µ–∂–∏–µ –∑–µ–ª—ë–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏',
                preview: ['#2e8b57', '#3cb371', '#f3fff7', '#e6f5ec']
            },
            {
                id: 'sakura',
                name: '–°–∞–∫—É—Ä–∞',
                emoji: 'üå∏',
                description: '–ù–µ–∂–Ω—ã–µ —Ä–æ–∑–æ–≤—ã–µ —Ç–æ–Ω–∞',
                preview: ['#ff9a9e', '#fad0c4', '#fff0f5', '#ffe3ec']
            },
            {
                id: 'neon',
                name: '–ù–µ–æ–Ω',
                emoji: '‚ö°',
                description: '–Ø—Ä–∫–∏–π –∫–∏–±–µ—Ä–ø–∞–Ω–∫ —Å—Ç–∏–ª—å',
                preview: ['#00ff88', '#ff00ff', '#0a0a0f', '#0f0f1a']
            },
            {
                id: 'cosmos',
                name: '–ö–æ—Å–º–æ—Å',
                emoji: 'üöÄ',
                description: '–ó–≤—ë–∑–¥–Ω–æ–µ –Ω–µ–±–æ',
                preview: ['#7b2fff', '#ff6b35', '#050514', '#0d0d2b']
            },
            {
                id: 'rainbow',
                name: '–†–∞–¥—É–≥–∞',
                emoji: 'üåà',
                description: '–ü–µ—Ä–µ–ª–∏–≤–∞—é—â–∏–π—Å—è —Ä–∞–¥—É–∂–Ω—ã–π',
                preview: ['#ff6b6b', '#ffcd3c', '#00c9a7', '#a855f7']
            },
            {
                id: 'candy',
                name: '–ö–æ–Ω—Ñ–µ—Ç–∫–∏',
                emoji: 'üç≠',
                description: '–°–ª–∞–¥–∫–∏–µ —è—Ä–∫–∏–µ —Ü–≤–µ—Ç–∞',
                preview: ['#ff6eb4', '#ffcd3c', '#fff9ff', '#ffe8f5']
            },
            {
                id: 'mint',
                name: '–ú—è—Ç–∞',
                emoji: 'üçÉ',
                description: '–°–≤–µ–∂–∞—è –º—è—Ç–Ω–∞—è –ø—Ä–æ—Ö–ª–∞–¥–∞',
                preview: ['#00c9a7', '#00e5cc', '#f0fffc', '#e0fff8']
            }
        ];

        const THEME_NAMES = {
            light: '–°–≤–µ—Ç–ª–∞—è', dark: '–¢—ë–º–Ω–∞—è', sunset: '–ó–∞–∫–∞—Ç',
            ocean: '–û–∫–µ–∞–Ω', forest: '–õ–µ—Å', sakura: '–°–∞–∫—É—Ä–∞',
            neon: '–ù–µ–æ–Ω', cosmos: '–ö–æ—Å–º–æ—Å', rainbow: '–†–∞–¥—É–≥–∞', candy: '–ö–æ–Ω—Ñ–µ—Ç–∫–∏', mint: '–ú—è—Ç–∞'
        };

        // === –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–æ–π ===
        function detectSystemTheme() {
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const theme = savedTheme || detectSystemTheme();
            applyTheme(theme);
        }

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            updateThemeIcon(theme);
            updateCurrentThemeName(theme);
            renderThemesGrid();
        }
        
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
            themeToggle.style.transform = 'rotate(360deg)';
            setTimeout(() => { themeToggle.style.transform = ''; }, 300);
        }
        
        function updateThemeIcon(theme) {
            if (theme === 'dark' || theme === 'neon' || theme === 'cosmos') {
                sunIcon.classList.remove('active');
                moonIcon.classList.add('active');
                themeToggle.setAttribute('aria-label', '–í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É');
            } else {
                moonIcon.classList.remove('active');
                sunIcon.classList.add('active');
                themeToggle.setAttribute('aria-label', '–í–∫–ª—é—á–∏—Ç—å —Ç—ë–º–Ω—É—é —Ç–µ–º—É');
            }
        }

        function updateCurrentThemeName(theme) {
            const el = document.getElementById('current-theme-name');
            if (el) el.textContent = THEME_NAMES[theme] || theme;
        }

        function renderThemesGrid() {
            const grid = document.getElementById('themes-grid');
            if (!grid) return;
            const currentTheme = document.documentElement.getAttribute('data-theme');

            grid.innerHTML = THEMES.map(theme => `
                <div class="theme-card ${theme.id === currentTheme ? 'active' : ''}" 
                     data-theme-id="${theme.id}"
                     title="${theme.description}">
                    <div class="theme-preview">
                        ${theme.preview.map(c => `<div class="preview-swatch" style="background:${c}"></div>`).join('')}
                    </div>
                    <div class="theme-card-body">
                        <span class="theme-emoji">${theme.emoji}</span>
                        <span class="theme-card-name">${theme.name}</span>
                        ${theme.id === currentTheme ? '<span class="theme-active-badge"><i class="fas fa-check"></i></span>' : ''}
                    </div>
                    <div class="theme-description">${theme.description}</div>
                </div>
            `).join('');

            grid.querySelectorAll('.theme-card').forEach(card => {
                card.addEventListener('click', () => {
                    const themeId = card.getAttribute('data-theme-id');
                    applyTheme(themeId);
                    showNotification(`–¢–µ–º–∞ ¬´${THEME_NAMES[themeId]}¬ª –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ ${THEMES.find(t=>t.id===themeId)?.emoji || ''}`, 'success');
                });
            });
        }

        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                if (!localStorage.getItem('theme')) {
                    applyTheme(e.matches ? 'dark' : 'light');
                }
            });
        }
        
        // === –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ===
        const generateBtn = document.getElementById('generate-btn');
        const autoBtn = document.getElementById('auto-btn');
        const copyBtn = document.getElementById('copy-btn');
        const showWordsBtn = document.getElementById('show-words-btn');
        const favoriteBtn = document.getElementById('favorite-btn');
        const themeToggle = document.getElementById('theme-toggle');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        const sentenceEl = document.getElementById('sentence');
        const wordsEl = document.getElementById('words');
        const wordListEl = document.getElementById('word-list');
        const counterEl = document.getElementById('counter');
        const totalEl = document.getElementById('total-combinations');
        const autoStatusEl = document.getElementById('auto-status');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const countdownEl = document.getElementById('countdown');
        
        const tabGenerateBtn = document.getElementById('tab-generate');
        const tabHistoryBtn = document.getElementById('tab-history');
        const tabFavoritesBtn = document.getElementById('tab-favorites');
        const tabThemesBtn = document.getElementById('tab-themes');
        const tabContentGenerate = document.getElementById('tab-content-generate');
        const tabContentHistory = document.getElementById('tab-content-history');
        const tabContentFavorites = document.getElementById('tab-content-favorites');
        const tabContentThemes = document.getElementById('tab-content-themes');
        const historyListEl = document.getElementById('history-list');
        const favoritesListEl = document.getElementById('favorites-list');
        
        let currentSentence = '';
        let currentWords = null;
        let currentSentenceId = null;
        let showWords = false;
        let autoInterval = null;
        let countdownInterval = null;
        let isAutoGenerating = false;
        const AUTO_INTERVAL_MS = 8000;
        let timeLeft = AUTO_INTERVAL_MS;
        
        let history = JSON.parse(localStorage.getItem('phraseHistory') || '[]');
        let favorites = JSON.parse(localStorage.getItem('phraseFavorites') || '[]');
        
        // === –ò—Å—Ç–æ—Ä–∏—è –∏ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ ===
        function saveToHistory(sentence, words) {
            const historyItem = {
                id: Date.now(),
                sentence,
                words,
                timestamp: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                date: new Date().toLocaleDateString()
            };
            history.unshift(historyItem);
            if (history.length > 10) history = history.slice(0, 10);
            localStorage.setItem('phraseHistory', JSON.stringify(history));
            updateHistoryDisplay();
        }

        function updateWordsDisplay() {
            wordsEl.style.display = showWords ? 'block' : 'none';
        }

        function updateFavoriteBtn() {
            const isFavorite = currentSentenceId && favorites.some(f => f.id === currentSentenceId);
            favoriteBtn.innerHTML = isFavorite ? '<i class="fas fa-heart"></i>' : '<i class="far fa-heart"></i>';
            favoriteBtn.classList.toggle('active', isFavorite);
            favoriteBtn.title = isFavorite ? '–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ' : '–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
        }
        
        function toggleFavorite() {
            if (!currentSentenceId || !currentSentence) return;
            const existingIndex = favorites.findIndex(f => f.id === currentSentenceId);
            if (existingIndex !== -1) {
                favorites.splice(existingIndex, 1);
                showNotification('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ üíî', 'info');
            } else {
                favorites.unshift({
                    id: currentSentenceId,
                    sentence: currentSentence,
                    words: currentWords,
                    timestamp: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                    date: new Date().toLocaleDateString(),
                    added: Date.now()
                });
                showNotification('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ üíñ', 'success');
            }
            localStorage.setItem('phraseFavorites', JSON.stringify(favorites));
            updateFavoriteBtn();
            updateFavoritesDisplay();
        }
        
        function removeFromFavorites(id) {
            favorites = favorites.filter(f => f.id !== id);
            localStorage.setItem('phraseFavorites', JSON.stringify(favorites));
            updateFavoritesDisplay();
            if (currentSentenceId === id) updateFavoriteBtn();
            showNotification('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ üóëÔ∏è', 'info');
        }
        
        function updateHistoryDisplay() {
            if (history.length === 0) {
                historyListEl.innerHTML = '<div class="empty-message">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –ø–µ—Ä–≤—É—é —Ñ—Ä–∞–∑—É!</div>';
                return;
            }
            historyListEl.innerHTML = history.map(item => `
                <div class="history-item" data-id="${item.id}">
                    <div class="history-text" title="–ö–ª–∏–∫–Ω–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å">${item.sentence}</div>
                    <div class="history-time">${item.timestamp}</div>
                </div>
            `).join('');
            document.querySelectorAll('.history-text').forEach((el, index) => {
                el.addEventListener('click', () => {
                    const item = history[index];
                    sentenceEl.textContent = item.sentence;
                    currentSentence = item.sentence;
                    currentWords = item.words;
                    currentSentenceId = item.id;
                    if (item.words) {
                        wordListEl.innerHTML = `–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ: <strong>${item.words.noun}</strong><br>–ì–ª–∞–≥–æ–ª: <strong>${item.words.verb}</strong><br>–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ: <strong>${item.words.adjective}</strong><br>–ú–µ—Å—Ç–æ: <strong>${item.words.place}</strong>`;
                    }
                    updateFavoriteBtn();
                    switchTab('generate');
                    showNotification('–§—Ä–∞–∑–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ üîÑ', 'info');
                });
            });
        }
        
        function updateFavoritesDisplay() {
            if (favorites.length === 0) {
                favoritesListEl.innerHTML = '<div class="empty-message">–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º –ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Ñ—Ä–∞–∑—É!</div>';
                return;
            }
            favoritesListEl.innerHTML = favorites.map(item => `
                <div class="favorite-item" data-id="${item.id}">
                    <div class="favorite-text" title="–ö–ª–∏–∫–Ω–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å">${item.sentence}</div>
                    <button class="remove-btn" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ"><i class="fas fa-trash"></i></button>
                </div>
            `).join('');
            document.querySelectorAll('.favorite-text').forEach((el, index) => {
                el.addEventListener('click', () => {
                    const item = favorites[index];
                    sentenceEl.textContent = item.sentence;
                    currentSentence = item.sentence;
                    currentWords = item.words;
                    currentSentenceId = item.id;
                    if (item.words) {
                        wordListEl.innerHTML = `–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ: <strong>${item.words.noun}</strong><br>–ì–ª–∞–≥–æ–ª: <strong>${item.words.verb}</strong><br>–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ: <strong>${item.words.adjective}</strong><br>–ú–µ—Å—Ç–æ: <strong>${item.words.place}</strong>`;
                    }
                    updateFavoriteBtn();
                    switchTab('generate');
                    showNotification('–§—Ä–∞–∑–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ üíñ', 'info');
                });
            });
            document.querySelectorAll('.remove-btn').forEach((btn, index) => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    removeFromFavorites(favorites[index].id);
                });
            });
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<span>${message}</span><button class="notification-close">&times;</button>`;
            notification.querySelector('.notification-close').addEventListener('click', () => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            });
            document.body.appendChild(notification);
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 3000);
        }
        
        // === –í–∫–ª–∞–¥–∫–∏ ===
        function switchTab(tabName) {
            [tabContentGenerate, tabContentHistory, tabContentFavorites, tabContentThemes].forEach(tab => tab.classList.remove('active'));
            [tabGenerateBtn, tabHistoryBtn, tabFavoritesBtn, tabThemesBtn].forEach(btn => btn.classList.remove('active'));
            switch(tabName) {
                case 'generate':
                    tabContentGenerate.classList.add('active');
                    tabGenerateBtn.classList.add('active');
                    break;
                case 'history':
                    tabContentHistory.classList.add('active');
                    tabHistoryBtn.classList.add('active');
                    updateHistoryDisplay();
                    break;
                case 'favorites':
                    tabContentFavorites.classList.add('active');
                    tabFavoritesBtn.classList.add('active');
                    updateFavoritesDisplay();
                    break;
                case 'themes':
                    tabContentThemes.classList.add('active');
                    tabThemesBtn.classList.add('active');
                    renderThemesGrid();
                    break;
            }
        }
        
        // === –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ===
        async function generateSentence() {
            try {
                sentenceEl.textContent = '–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º...';
                sentenceEl.style.opacity = '0.7';
                const response = await fetch('/generate');
                const data = await response.json();
                sentenceEl.textContent = data.sentence;
                sentenceEl.style.opacity = '1';
                sentenceEl.classList.add('new-sentence');
                setTimeout(() => sentenceEl.classList.remove('new-sentence'), 500);
                currentSentence = data.sentence;
                currentWords = data.words;
                currentSentenceId = Date.now();
                wordListEl.innerHTML = `–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ: <strong>${data.words.noun}</strong><br>–ì–ª–∞–≥–æ–ª: <strong>${data.words.verb}</strong><br>–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ: <strong>${data.words.adjective}</strong><br>–ú–µ—Å—Ç–æ: <strong>${data.words.place}</strong>`;
                counterEl.textContent = data.stats.total;
                totalEl.textContent = data.stats.combinations.toLocaleString();
                updateFavoriteBtn();
                saveToHistory(data.sentence, data.words);
                updateWordsDisplay();
            } catch (error) {
                sentenceEl.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ üò¢';
                console.error('–û—à–∏–±–∫–∞:', error);
                if (isAutoGenerating) toggleAutoGeneration();
            }
        }
        
        // === –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä ===
        function startProgressAnimation() {
            if (!isAutoGenerating) return;
            progressBar.style.transition = 'none';
            progressBar.style.width = '0%';
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    progressBar.style.transition = `width ${AUTO_INTERVAL_MS}ms linear`;
                    progressBar.style.width = '100%';
                });
            });
        }
        
        function updateCountdown() {
            if (!isAutoGenerating) return;
            timeLeft -= 1000;
            countdownEl.textContent = `${timeLeft / 1000} —Å–µ–∫`;
            if (timeLeft <= 0) {
                timeLeft = AUTO_INTERVAL_MS;
                countdownEl.textContent = '8 —Å–µ–∫';
            }
        }
        
        // === –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è ===
        function toggleAutoGeneration() {
            if (isAutoGenerating) {
                clearInterval(autoInterval);
                clearInterval(countdownInterval);
                autoBtn.innerHTML = '<span class="emoji">‚ñ∂Ô∏è</span> –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è';
                autoBtn.style.background = 'linear-gradient(to right, var(--primary), var(--secondary))';
                autoStatusEl.textContent = '–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—ã–∫–ª—é—á–µ–Ω–∞';
                autoStatusEl.style.color = '';
                autoBtn.classList.remove('active');
                progressContainer.style.display = 'none';
                isAutoGenerating = false;
            } else {
                autoBtn.innerHTML = '<span class="emoji">‚è∏Ô∏è</span> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
                autoBtn.style.background = 'linear-gradient(to right, #ff416c, #ff4b2b)';
                autoStatusEl.textContent = '–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞ (–∫–∞–∂–¥—ã–µ 8 —Å–µ–∫—É–Ω–¥)';
                autoStatusEl.style.color = '#ff416c';
                autoBtn.classList.add('active');
                progressContainer.style.display = 'block';
                isAutoGenerating = true;
                timeLeft = AUTO_INTERVAL_MS;
                countdownEl.textContent = '8 —Å–µ–∫';
                generateSentence();
                startProgressAnimation();
                countdownInterval = setInterval(updateCountdown, 1000);
                autoInterval = setInterval(() => {
                    generateSentence();
                    startProgressAnimation();
                    timeLeft = AUTO_INTERVAL_MS;
                    countdownEl.textContent = '8 —Å–µ–∫';
                }, AUTO_INTERVAL_MS);
            }
        }
        
        // === –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ ===
        function copyToClipboard() {
            navigator.clipboard.writeText(sentenceEl.textContent).then(() => {
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span class="emoji">‚úÖ</span> –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                copyBtn.style.background = 'linear-gradient(to right, #4CAF50, #2E7D32)';
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = 'linear-gradient(to right, #f093fb, #f5576c)';
                }, 2000);
                showNotification('–§—Ä–∞–∑–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ üìã', 'success');
            });
        }
        
        function toggleWords() {
            showWords = !showWords;
            updateWordsDisplay();
            showWordsBtn.innerHTML = showWords 
                ? '<span class="emoji">üëÅÔ∏è</span> –°–∫—Ä—ã—Ç—å —Å–ª–æ–≤–∞' 
                : '<span class="emoji">üîç</span> –ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≤–∞';
        }
        
        function handleSentenceClick() {
            generateSentence();
            sentenceEl.style.transform = 'scale(0.98)';
            setTimeout(() => { sentenceEl.style.transform = 'scale(1)'; }, 150);
        }
        
        // === PWA ===
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');
        const installPrompt = document.getElementById('install-prompt');
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installPrompt.style.display = 'block';
        });
        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installPrompt.style.display = 'none';
                    showNotification('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ! üì±', 'success');
                }
                deferredPrompt = null;
            });
        }
        
        // === –°–æ–±—ã—Ç–∏—è ===
        generateBtn.addEventListener('click', generateSentence);
        autoBtn.addEventListener('click', toggleAutoGeneration);
        copyBtn.addEventListener('click', copyToClipboard);
        showWordsBtn.addEventListener('click', toggleWords);
        favoriteBtn.addEventListener('click', toggleFavorite);
        themeToggle.addEventListener('click', toggleTheme);
        sentenceEl.addEventListener('click', handleSentenceClick);
        tabGenerateBtn.addEventListener('click', () => switchTab('generate'));
        tabHistoryBtn.addEventListener('click', () => switchTab('history'));
        tabFavoritesBtn.addEventListener('click', () => switchTab('favorites'));
        tabThemesBtn.addEventListener('click', () => switchTab('themes'));
        
        // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
        window.addEventListener('load', () => {
            initTheme();
            updateHistoryDisplay();
            updateFavoritesDisplay();
            setTimeout(() => {
                generateSentence();
                sentenceEl.style.cursor = 'pointer';
                sentenceEl.title = '–ö–ª–∏–∫–Ω–∏ –¥–ª—è –Ω–æ–≤–æ–π —Ñ—Ä–∞–∑—ã!';
            }, 300);
        });
        
        // === –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ ===
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault();
                generateSentence();
                document.activeElement.blur();
                generateBtn.style.transform = 'scale(0.95)';
                setTimeout(() => { generateBtn.style.transform = ''; }, 150);
            }
            if (e.altKey) {
                switch(e.code) {
                    case 'KeyC': e.preventDefault(); copyToClipboard(); break;
                    case 'KeyT': e.preventDefault(); toggleTheme(); break;
                    case 'KeyA': e.preventDefault(); toggleAutoGeneration(); break;
                    case 'KeyW': e.preventDefault(); toggleWords(); showWordsBtn.style.transform = 'scale(0.95)'; setTimeout(() => { showWordsBtn.style.transform = ''; }, 150); break;
                    case 'KeyF': e.preventDefault(); toggleFavorite(); break;
                    case 'Digit1': e.preventDefault(); switchTab('generate'); break;
                    case 'Digit2': e.preventDefault(); switchTab('history'); break;
                    case 'Digit3': e.preventDefault(); switchTab('favorites'); break;
                    case 'Digit4': e.preventDefault(); switchTab('themes'); break;
                }
            }
        });
        
        window.addEventListener('beforeunload', () => {
            if (isAutoGenerating) {
                clearInterval(autoInterval);
                clearInterval(countdownInterval);
            }
        });
        
        sentenceEl.addEventListener('mouseenter', () => { sentenceEl.style.boxShadow = '0 0 20px rgba(var(--primary-rgb), 0.3)'; });
        sentenceEl.addEventListener('mouseleave', () => { sentenceEl.style.boxShadow = ''; });
    </script>
</body>
</html>